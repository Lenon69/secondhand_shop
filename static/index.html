<!DOCTYPE html>

<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta" />
    <meta
      name="description"
      content="Odkryj unikalną odzież vintage w mess - all that vintage. Najlepsze perełki z drugiej ręki dla niej i dla niego."
    />
    <title>mess - all that vintage - Sklep Vintage Online</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script
      src="https://unpkg.com/htmx.org@2.0.4/dist/htmx.min.js"
      defer
    ></script>
    <script
      src="https://unpkg.com/alpinejs@3.14.1/dist/cdn.min.js"
      defer
    ></script>
    <script src="/static/app.js" defer></script>
    
    <style type="text/tailwindcss">
      [x-cloak] {
        display: none !important;
      }
      .htmx-indicator {
        display: none;
        opacity: 0;
        transition: opacity 200ms ease-in;
      }
      .htmx-request .htmx-indicator {
        display: inline-block;
        opacity: 1;
      }
      .htmx-request.htmx-indicator {
        display: inline-block;
        opacity: 1;
      }
      .mobile-nav-active {
        @apply bg-pink-50 text-pink-700 font-semibold;
      }
      #category-sidebar::-webkit-scrollbar {
        width: 8px;
      }
      #category-sidebar::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }
      #category-sidebar::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 10px;
      }
      #category-sidebar::-webkit-scrollbar-thumb:hover {
        background: #9ca3af;
      }
      #category-sidebar {
        scrollbar-width: thin;
        scrollbar-color: #d1d5db #f1f1f1;
      }
      
      /* Style dla Panelu Admina */
      .admin-th {
        @apply px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider;
      }
      .admin-td {
        @apply px-4 py-2 whitespace-nowrap text-sm;
      }
      .admin-td-image {
        @apply px-4 py-2 whitespace-nowrap; /* Bez text-sm, bo zawiera obrazek */
      }
      .admin-action-button {
        @apply p-1 rounded-md transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-offset-1;
      }
      .admin-action-button:hover {
        @apply bg-gray-100;
      }
      .admin-filter-select, .admin-filter-input {
        @apply block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm transition-colors;
      }
      .admin-filter-button {
        @apply font-semibold py-2 px-4 rounded-md shadow-sm text-sm transition-colors duration-150 ease-in-out;
      }
      .admin-pagination-button {
        @apply px-3 py-1 border border-gray-300 rounded-md text-gray-700 hover:bg-pink-50 hover:border-pink-300 hover:text-pink-700 transition-all duration-150;
      }
      .admin-pagination-button-active {
        @apply px-3 py-1 border border-pink-600 bg-pink-600 text-white rounded-md;
      }
      .admin-pagination-button-disabled {
        @apply px-3 py-1 border border-gray-300 text-gray-400 bg-gray-100 rounded-md cursor-not-allowed;
      }
      .admin-pagination-dots {
        @apply px-2 py-1 text-gray-500;
      }
      
      /* Style dla globalnego spinnera */
      #global-loading-spinner {
        display: none;
        opacity: 0.5;
        visibility: hidden;
        transition: opacity 200ms ease-in-out, visibility 0s linear 200ms;
        background-color: rgba(20, 20, 30, 0.5);
        backdrop-filter: blur(4px);
      }
      
      #global-loading-spinner.show {
        display: flex;
        opacity: 1;
        visibility: visible;
        transition: opacity 200ms ease-in-out, visibility 0s;
      }

      #global-loading-spinner svg {
      color: #E91E63;
      filter: drop-shadow(0 0 5px rgba(0,0,0,0.3));
      }
    
    
    /* Poprawki dla skalowania 125% na ekranach fizycznie szerokich */
    @media (min-width: 1500px) { /* Celujemy w ekrany 1920px@125% = 1536px */
      .dpr-125 .lg\:hidden {
        display: none !important;
      }
      .dpr-125 .hidden.lg\:flex {
        display: flex !important;
      }
    }

    /* Poprawki dla skalowania 150% na ekranach fizycznie szerokich */
    @media (min-width: 1280px) { /* Celujemy w ekrany 1920px@150% = 1280px */
      .dpr-150 .lg\:hidden {
        display: none !important;
      }
      .dpr-150 .hidden.lg\:flex {
        display: flex !important;
      }
    }
  
    </style>

    <style>
      form.htmx-request .search-button-text {
        display: none;
      }
    </style>

    <link rel="icon" href="/static/favico.png" type="image/x-icon" />
    <div id="head-scripts-placeholder"></div>
  </head>

  <body
    x-data="{
        // --- Właściwości (stan) komponentu ---
        isAuthenticated: false,
        cartOpen: false,
        cartItemCount: 0,
        guestCartId: null,
        isMobileMenuOpen: false,
        currentMobilePage: '', 
        isCategorySidebarOpen: false,
        
        // --- Właściwości dla modalu ze zdjęciami ---
        activeImageModal: {
            isOpen: false,
            currentSrc: '',
            images: [],
            currentIndex: 0
        },
        
        // --- Właściwości przeniesione z komponentu powiadomień ---
        toast: {
            show: false,
            message: '',
            type: 'info',
            timeout: 2000,
            hideTimeoutId: null
        },
        
        // --- NOWE WŁAŚCIWOŚCI DO OBSŁUGI GESTU SWIPE ---
        touchStartX: 0,
        touchEndX: 0,
        swipeThreshold: 65, // Minimalna odległość w pikselach, aby uznać gest za swipe
        isSwiping: false,
        

        // --- Metody (logika) komponentu ---

        // Metoda inicjalizacyjna, uruchamiana przez x-init
        init() {
            if (window.alpineBodyInitialized) return;
            window.alpineBodyInitialized = true;
            console.log('✅ Alpine.js poprawnie zainicjalizowany!');
            
            // 1. Ustaw stan autoryzacji
            this.isAuthenticated = !!localStorage.getItem('jwtToken');
            
            // 2. Jeśli jest gościem, upewnij się, że ma sesję
            if (!this.isAuthenticated) {
                this.ensureGuestSession();
            }

            // 3. Załaduj stan licznika koszyka
            this.cartItemCount = parseInt(localStorage.getItem('cartItemCount')) || 0;

            // --- POCZĄTEK NOWEJ LOGIKI ---

            // 1. Sprawdź przy ładowaniu, czy strona została otwarta z hashem #cart
            if (location.hash === '#cart') {
                this.cartOpen = true;
            }

            // 2. Nasłuchuj na zdarzenie 'popstate' (przyciski wstecz/dalej przeglądarki)
            window.addEventListener('popstate', () => {
                // Zsynchronizuj stan koszyka z obecnością hasha w URL
                this.cartOpen = (location.hash === '#cart');
            });

            // 3. Obserwuj zmiany w stanie 'cartOpen'
            $watch('cartOpen', (isOpen) => {
                const hasCartHash = location.hash === '#cart';
    
                if (isOpen && !hasCartHash) {
                    history.pushState({ cartOpen: true }, '', '#cart');
                } else if (!isOpen && hasCartHash) {
                    history.replaceState(null, '', window.location.pathname + window.location.search);
                }
            });
            // --- KONIEC NOWEJ LOGIKI ---




            // 4. Ustaw nasłuch na zmiany i zapisuj je w localStorage
            this.$watch('cartItemCount', value => localStorage.setItem('cartItemCount', String(value)));
            this.$watch('guestCartId', value => {
                if (value) {
                    localStorage.setItem('guestCartId', value);
                } else {
                    localStorage.removeItem('guestCartId');
                }
            });

            // 5. Nasłuchuj na globalne zdarzenia z innych części aplikacji
            this.addGlobalEventListeners();
            
            
        },
        
        // --- Metody pomocnicze ---
        addGlobalEventListeners() {
            window.addEventListener('authChangedClient', event => {
                console.log('[Alpine] Odebrano authChangedClient, isAuthenticated:', event.detail.isAuthenticated);
                this.isAuthenticated = event.detail.isAuthenticated;
            });

            // Zdarzenie do pokazywania powiadomień (toastów)
            window.addEventListener('showMessage', event => {
                if (event.detail && event.detail.message) {
                    this.showToast(event.detail.message, event.detail.type);
                }
            });

            document.body.addEventListener('htmx:afterOnLoad', (event) => {
                try {
                  const json = JSON.parse(event.detail.xhr.responseText);
                  if (json.showMessage) {
                    window.dispatchEvent(
                      new CustomEvent('showMessage', { detail: json.showMessage }),
                    );
                  }
                } catch (_) {
                }
              });

            document.body.addEventListener('updateCartCount', (event) => {
                if (!event.detail) return;
                this.handleHtmxCartUpdate(event.detail);
            });
            
            document.body.addEventListener('loginSuccessDetails', (event) => {
                if (event.detail?.token) {
                  localStorage.setItem('jwtToken', event.detail.token);
                  console.log('Logowanie pomyślne. Przeładowuję stronę...');
                  window.location.replace('/');
                }
            });
            
            document.body.addEventListener('registrationComplete', () => {
                htmx.ajax('GET', '/htmx/logowanie', {
                    target: '#content',
                    swap: 'innerHTML',
                    pushUrl: '/logowanie',
                });
            });

            document.body.addEventListener('clearCartDisplay', () => {
                this.handleHtmxCartUpdate({ newCount: 0, newCartTotalPrice: 0 });
                htmx.ajax('GET', '/htmx/cart/details', {
                    target: '#cart-content-target',
                    swap: 'innerHTML',
                });
            });

            window.addEventListener('logoutClient', () => {
                this.clientSideLogout();
            });
        },
        
       showToast(message, type = 'info') {
          this.toast.message = message;
          this.toast.type = type;
          this.toast.show = true;

          if (this.toast.hideTimeoutId) clearTimeout(this.toast.hideTimeoutId);

          this.toast.hideTimeoutId = setTimeout(() => {
              this.toast.show = false;
          }, this.toast.timeout);
        },

        // Metoda do inicjalizacji sesji gościa
        ensureGuestSession() {
            let guestId = localStorage.getItem('guestCartId');
            if (!guestId) {
                console.log('Brak sesji gościa. Inicjalizuję nową na serwerze...');
                fetch('/api/session/guest/init', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(res => res.ok ? res.json() : Promise.reject('Błąd inicjalizacji sesji gościa'))
                .then(data => {
                    console.log('Otrzymano nowe ID gościa od serwera:', data.guestCartId);
                    this.guestCartId = data.guestCartId; // To uruchomi $watch
                })
                .catch(err => console.error('Błąd podczas inicjalizacji sesji gościa:', err));
            } else {
                this.guestCartId = guestId;
            }
        },

        // Metoda do obsługi aktualizacji koszyka
        handleHtmxCartUpdate(detail) {
            if (detail?.newCount !== undefined) {
                this.cartItemCount = parseInt(detail.newCount) || 0;
            }
            if (detail?.newCartTotalPrice !== undefined) {
                 const el = document.getElementById('cart-subtotal-price');
                 if (el) {
                    const price = (parseInt(detail.newCartTotalPrice, 10) / 100).toFixed(2);
                    el.innerHTML = `${price.replace('.', ',')} zł`;
                 }
            }
        },

        openImageModal(src, imagesArray) {
            this.activeImageModal.images = Array.isArray(imagesArray) ? imagesArray : [];
            this.activeImageModal.currentIndex = this.activeImageModal.images.indexOf(src);
            if (this.activeImageModal.currentIndex === -1 && this.activeImageModal.images.length > 0) {
                this.activeImageModal.currentIndex = 0;
            }
            this.activeImageModal.currentSrc = this.activeImageModal.images[this.activeImageModal.currentIndex] || src;
            this.activeImageModal.isOpen = true;
            // Ważne: blokujemy scrollowanie tła, gdy modal jest otwarty
            document.body.style.overflow = 'hidden';
        },

        closeImageModal() {
            // >>> DODANA LINIA <<<
            // Wysyłamy niestandardowe zdarzenie, aby poinformować komponent obrazka, że ma zresetować zoom.
            this.$dispatch('reset-image-zoom');

            this.activeImageModal.isOpen = false;
            // Przywracamy scrollowanie tła
            document.body.style.overflow = '';

            // --- NOWA LOGIKA DO RESETOWANIA ZOOMU ---
            const viewport = document.getElementById('viewport-meta');
            if (viewport) {
                const content = viewport.getAttribute('content');
                viewport.setAttribute('content', 'width=device-width, initial-scale=0.1');
                setTimeout(() => {
                    viewport.setAttribute('content', content);
                }, 10);
            }
        },
        nextImageModal() {
            if (this.activeImageModal.images.length > 0) {
                this.activeImageModal.currentIndex = (this.activeImageModal.currentIndex + 1) % this.activeImageModal.images.length;
                this.activeImageModal.currentSrc = this.activeImageModal.images[this.activeImageModal.currentIndex];
            }
        },
        prevImageModal() {
            if (this.activeImageModal.images.length > 0) {
                this.activeImageModal.currentIndex = (this.activeImageModal.currentIndex - 1 + this.activeImageModal.images.length) % this.activeImageModal.images.length;
                this.activeImageModal.currentSrc = this.activeImageModal.images[this.activeImageModal.currentIndex];
            }
        },
       
        // --- NOWE METODY DO OBSŁUGI GESTU SWIPE ---

        handleTouchStart(event) {
            // Rozpoczynaj gest tylko jeśli na ekranie jest DOKŁADNIE jeden palec
            if (event.touches.length === 1) {
                this.isSwiping = true;
                this.touchStartX = event.touches[0].clientX;
                // Resetujemy pozycję końcową na starcie gestu
                this.touchEndX = event.touches[0].clientX; 
            } else {
                // Jeśli jest więcej palców, to na pewno nie jest swipe (np. zoom)
                this.isSwiping = false;
            }
        },

        // Wywoływana podczas przesuwania palcem po ekranie
        handleTouchMove(event) {
            // Kontynuuj śledzenie tylko jeśli jesteśmy w trakcie prawidłowego swipe'u
            if (this.isSwiping && event.touches.length === 1) {
                this.touchEndX = event.touches[0].clientX;
            } else {
                // Jeśli użytkownik dodał drugi palec w trakcie, anuluj swipe
                this.isSwiping = false;
            }
        },

        // Wywoływana po oderwaniu palca od ekranu
        handleTouchEnd() {
            // Zmień zdjęcie tylko jeśli gest był poprawnym swipe'em od początku do końca
            if (this.isSwiping) {
                const deltaX = this.touchEndX - this.touchStartX;
                if (Math.abs(deltaX) > this.swipeThreshold) {
                    if (deltaX < 0) {
                        console.log('Swipe w lewo - następne zdjęcie');
                        this.nextImageModal();
                    } else {
                        console.log('Swipe w prawo - poprzednie zdjęcie');
                        this.prevImageModal();
                    }
                }
            }
            // Zawsze resetuj stan po zakończeniu gestu
            this.isSwiping = false;
            this.touchStartX = 0;
            this.touchEndX = 0;
        },        
        
        clientSideLogout() {
            console.log('Wykonywanie clientSideLogout.');
            localStorage.removeItem('jwtToken');
            
            window.dispatchEvent(new CustomEvent('authChangedClient', { detail: { isAuthenticated: false } }));
            this.isMobileMenuOpen = false;
            window.location.replace('/');
        }
    }"
    x-init="init()"
    x-on:open-alpine-modal.window="openImageModal($event.detail.src, $event.detail.imagesArray)"
    x-on:js-update-cart.document="handleHtmxCartUpdate($event.detail)"
    x-on:keydown.escape.window="if(activeImageModal.isOpen) closeImageModal()"
    x-on:keydown.left.window="if(activeImageModal.isOpen && activeImageModal.images.length > 1) prevImageModal()"
    x-on:keydown.right.window="if(activeImageModal.isOpen && activeImageModal.images.length > 1) nextImageModal()"
    class="flex flex-col min-h-screen bg-gray-50 text-gray-900 font-sans antialiased"
  >
  
    <div id="global-loading-spinner" class="fixed inset-0 bg-slate-700 bg-opacity-50 flex justify-center items-center z-[9999]">
        <svg class="animate-spin h-12 w-12 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
    </div>  
  
    <header class="sticky top-0 z-40 bg-white/95 backdrop-blur-sm shadow-md">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <h1>
            <a
              href="/"
              hx-get="/"
              hx-target="#content"
              hx-push-url="/"
              hx-swap="innerHTML"
              hx-cache="bust"
              @click="isMobileMenuOpen = false; currentMobilePage=''"
              class="block hover:opacity-80 transition-opacity duration-200"
              aria-label="Strona główna - mess - all that vintage"
            >
              <img
                src="/static/main-logo.png"
                alt="mess - all that vintage"
                class="h-22 w-auto" 
              />
              </a>
            </h1>
          <div 
              class="hidden lg:flex flex-1 justify-center items-center px-6 relative"
              x-data="{ hasResults: false }"
              @htmx:after-request="if ($event.target.id === 'live-search-input') hasResults = $event.detail.xhr.responseText.trim() !== ''"
              @click.away="hasResults = false"
          >
              <div class="w-full max-w-md">
                  <form
                      hx-get="/htmx/products"
                      hx-target="#content"
                      hx-swap="innerHTML"
                      hx-push-url="true"
                      class="flex w-full"
                      @submit="hasResults = false"
                  >
                      <input 
                          type="search"
                          name="search"
                          id="live-search-input"
                          placeholder="Szukaj perełek..."
                          class="w-full px-4 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-shadow text-sm"
                          aria-label="Wyszukaj produkty"
                          autocomplete="off"

                          hx-get="/htmx/live-search"
                          hx-trigger="keyup changed delay:300ms, search"
                          hx-target="#live-search-results"
                          hx-swap="innerHTML"

                          @focus="hasResults = true"
                          @keydown.escape.window="hasResults = false"
                      />
                      <button 
                          type="submit"
                          class="px-4 py-2 bg-black text-white rounded-r-lg transition-colors duration-300 ease-in-out hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 text-sm"
                          aria-label="Szukaj"
                      >
                          <span class="search-button-text">Szukaj</span>
                      </button>
                  </form>

                  <div
                      x-show="hasResults"
                      x-transition
                      id="live-search-results"
                      class="absolute mt-1 w-full max-w-md bg-white rounded-md shadow-lg z-20 overflow-hidden border border-gray-200"
                  >
                      </div>
              </div>
          </div>
          <div class="hidden lg:flex items-center space-x-4">
         <a  x-bind:href="isAuthenticated ? '/moje-konto' : '/logowanie'"
            x-bind:hx-get="isAuthenticated ? '/htmx/my-account' : '/htmx/logowanie'"
            hx-target="#content" hx-swap="innerHTML"
            x-bind:hx-push-url="isAuthenticated ? '/moje-konto' : '/logowanie'"
            @click="currentMobilePage = isAuthenticated ? 'moje-konto' : 'logowanie'"
            class="flex items-center space-x-1 text-gray-700 hover:text-pink-600 transition-colors"
            aria-label="Moje konto">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
            <span class="text-sm" x-text="isAuthenticated ? 'Moje konto' : 'Zaloguj się'"></span>
        </a>                        
    <button
        @click="cartOpen = true; $el.dispatchEvent(new CustomEvent('cartOpened', {bubbles: true, composed: true}))"
        class="relative flex items-center space-x-1 text-gray-700 hover:text-pink-600 transition-colors transform hover:scale-105 focus:outline-none"
        aria-label="Otwórz koszyk"
    >
        <svg
            class="w-7 h-7 flex-shrink-0"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            viewBox="0 0 24 24"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"
            />
        </svg>
        <span class="text-sm">Koszyk</span>
        <span
            id="cart-count-bubble"
            x-text="cartItemCount"
            x-show="cartItemCount > 0"
            x-cloak
            class="absolute -top-2 -right-2 bg-pink-600 text-white text-xs font-semibold rounded-full w-5 h-5 flex items-center justify-center ring-2 ring-white"
        ></span>
    </button>
</div>            <button
              @click="cartOpen = true; $el.dispatchEvent(new CustomEvent('cartOpened', {bubbles: true, composed: true}))"
              class="lg:hidden relative p-1 text-gray-700 hover:text-pink-600 transition-colors transform hover:scale-105 focus:outline-none"
              aria-label="Otwórz koszyk"
            >
              <svg
                class="w-7 h-7"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"
                /></svg
              ><span
                id="cart-count-bubble-mobile"
                x-text="cartItemCount"
                x-show="cartItemCount > 0"
                x-cloak
                class="absolute -top-1.5 -right-1.5 bg-pink-600 text-white text-[0.6rem] font-semibold rounded-full w-4 h-4 flex items-center justify-center ring-1 ring-white"
              ></span>
            </button>
            <div class="flex items-center lg:hidden">
              <button
                @click="isMobileMenuOpen = !isMobileMenuOpen"
                aria-label="Menu"
                class="p-2 rounded-md text-gray-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-pink-500"
              >
                <svg
                  x-show="!isMobileMenuOpen"
                  class="w-6 h-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 6h16M4 12h16M4 18h16"
                  ></path></svg
                ><svg
                  x-show="isMobileMenuOpen"
                  x-cloak
                  class="w-6 h-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  ></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
      <nav class="hidden lg:flex bg-gray-50 border-t border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div
            class="flex justify-center space-x-3 xl:space-x-4 py-3 text-sm font-medium"
          >
            <a
              href="/dla-niej"
              hx-get="/dla-niej"
              hx-target="#content"
              hx-push-url="/dla-niej"
              hx-swap="innerHTML"
              @click="currentMobilePage='damska'; isCategorySidebarOpen = false"
              class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md transition-all duration-200 ease-out hover:bg-pink-50"
              >Dla niej</a
            >
            <a
              href="/dla-niego"
              hx-get="/dla-niego"
              hx-target="#content"
              hx-push-url="/dla-niego"
              hx-swap="innerHTML"
              @click="currentMobilePage='meska'; isCategorySidebarOpen = false"
              class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md transition-all duration-200 ease-out hover:bg-pink-50"
              >Dla niego</a
            >
            <a
              href="/nowosci"
              hx-get="/nowosci"
              hx-target="#content"
              hx-push-url="/nowosci"
              hx-swap="innerHTML"
              @click="currentMobilePage='nowosci'"
              class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md transition-all duration-200 ease-out hover:bg-pink-50"
              >Nowości</a
            >
            <a
              href="/okazje"
              hx-get="/okazje"
              hx-target="#content"
              hx-push-url="/okazje"
              hx-swap="innerHTML"
              @click="currentMobilePage='okazje'"
              class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md transition-all duration-200 ease-out hover:bg-pink-50"
              >Okazje</a
            >
            <a
              href="/o-nas"
              hx-get="/htmx/page/o-nas"
              hx-target="#content"
              hx-push-url="/o-nas"
              hx-swap="innerHTML"
              @click="currentMobilePage='o-nas'"
              class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md transition-all duration-200 ease-out hover:bg-pink-50"
              >O nas</a
            >
            <a
              href="/kontakt"
              hx-get="/htmx/page/kontakt"
              hx-target="#content"
              hx-push-url="/kontakt"
              hx-swap="innerHTML"
              @click="currentMobilePage='kontakt'"
              class="text-gray-700 hover:text-pink-600 px-3 py-2 rounded-md transition-all duration-200 ease-out hover:bg-pink-50"
              >Kontakt</a
            >
          </div>
        </div>
      </nav>
      <div
        x-show="isMobileMenuOpen"
        x-cloak
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 -translate-y-4"
        x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 -translate-y-4"
        class="lg:hidden absolute top-16 inset-x-0 z-30 bg-white shadow-lg border-t border-gray-200 overflow-y-auto"
        @click.away="isMobileMenuOpen = false"
      >
        <div class="pt-2 pb-3 space-y-1 px-2">
          <div 
              class="mt-6 relative"
              x-data="{ hasMobileResults: false }"
              @htmx:after-request="if ($event.target.id === 'mobile-search-input') hasMobileResults = $event.detail.xhr.responseText.trim() !== ''"
              @click.away="hasMobileResults = false"
          >
              <form 
                  action="/wyszukiwanie" 
                  method="GET" 
                  class="group relative"
                  @submit="hasMobileResults = false"
              >
                  <input
                      id="mobile-search-input"
                      class="block w-full rounded-md border border-gray-300 text-center bg-white py-2 pl-10 pr-4 text-gray-900 placeholder:text-gray-400 focus:outline-none focus:border-pink-500 focus:ring-1 focus:ring-pink-500 transition-shadow sm:text-sm sm:leading-6"
                      placeholder="Szukaj..."
                      type="search"
                      name="search"
                      autocomplete="off"

                      hx-get="/htmx/live-search"
                      hx-trigger="keyup changed delay:300ms, search"
                      hx-target="#mobile-live-search-results"
                      hx-swap="innerHTML"

                      @focus="hasMobileResults = true"
                      @keydown.escape.window="hasMobileResults = false"
                  />
                  <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                          <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"></path>
                      </svg>
                  </div>
              </form>
    
              <div
                  x-show="hasMobileResults"
                  x-transition
                  id="mobile-live-search-results"
                  class="absolute mt-1 w-full bg-white rounded-md shadow-lg z-20 overflow-hidden border border-gray-200"
              >
                  </div>
          </div>
          <a
            href="/dla-niej"
            hx-get="/dla-niej"
            hx-target="#content"
            hx-swap="innerHTML"
            hx-push-url="/dla-niej"
            @click="isMobileMenuOpen = false; currentMobilePage='damska'; isCategorySidebarOpen = false"
            :class="{'mobile-nav-active': currentMobilePage === 'damska'}"
            class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-pink-50 hover:text-pink-700 text-center"
            >Dla niej</a
          >
          <a
            href="/dla-niego"
            hx-get="/dla-niego"
            hx-target="#content"
            hx-swap="innerHTML"
            hx-push-url="/dla-niego"
            @click="isMobileMenuOpen = false; currentMobilePage='meska'; isCategorySidebarOpen = false"
            :class="{'mobile-nav-active': currentMobilePage === 'meska'}"
            class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-pink-50 hover:text-pink-700 text-center"
            >Dla niego</a
          >
          <a
            href="/nowosci"
            hx-get="/nowosci"
            hx-target="#content"
            hx-swap="innerHTML"
            hx-push-url="/nowosci"
            @click="isMobileMenuOpen = false; currentMobilePage='nowosci'"
            :class="{'mobile-nav-active': currentMobilePage === 'nowosci'}"
            class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-pink-50 hover:text-pink-700 text-center"
            >Nowości</a
          >
          <a
            href="/okazje"
            hx-get="/okazje"
            hx-target="#content"
            hx-swap="innerHTML"
            hx-push-url="/okazje"
            @click="isMobileMenuOpen = false; currentMobilePage='okazje'"
            :class="{'mobile-nav-active': currentMobilePage === 'okazje'}"
            class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-pink-50 hover:text-pink-700 text-center"
            >Okazje</a
          >
          <a
            href="/o-nas"
            hx-get="/htmx/page/o-nas"
            hx-target="#content"
            hx-swap="innerHTML"
            hx-push-url="/o-nas"
            @click="isMobileMenuOpen = false; currentMobilePage='o-nas'"
            :class="{'mobile-nav-active': currentMobilePage === 'o-nas'}"
            class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-pink-50 hover:text-pink-700 text-center"
            >O nas</a
          >
          <a
            href="/kontakt"
            hx-get="/htmx/page/kontakt"
            hx-target="#content"
            hx-swap="innerHTML"
            hx-push-url="/kontakt"
            @click="isMobileMenuOpen = false; currentMobilePage='kontakt'"
            :class="{'mobile-nav-active': currentMobilePage === 'kontakt'}"
            class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-pink-50 hover:text-pink-700 text-center"
            >Kontakt</a
          >
            <div class="pt-4 pb-3 border-t border-gray-200">
                <div class="flex items-center justify-center px-3">
                     <a x-bind:href="isAuthenticated ? '/moje-konto' : '/logowanie'"
                        x-bind:hx-get="isAuthenticated ? '/htmx/my-account' : '/htmx/logowanie'"
                        hx-target="#content"
                        hx-swap="innerHTML"
                        x-bind:hx-push-url="isAuthenticated ? '/moje-konto' : '/logowanie'"
                        @click="isMobileMenuOpen = false; currentMobilePage = isAuthenticated ? 'moje-konto' : 'logowanie'"
                        class="flex items-center justify-center text-base font-medium text-gray-700 hover:text-pink-700 w-full">
                        <svg class="w-6 h-6 mr-2 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"></path></svg>
                        <span x-text="isAuthenticated ? 'Moje Konto' : 'Zaloguj / Zarejestruj się'"></span>
                    </a>
                </div>
                <div x-show="isAuthenticated" x-cloak class="mt-2 px-1"> 
                    <button
                      hx-post="/api/auth/logout"
                      hx-swap="none"
                      @click="clientSideLogout()" class="w-full flex items-center justify-center text-base font-medium text-red-600 hover:text-red-700 hover:bg-red-50 px-3 py-2 rounded-md">
                        <svg class="w-6 h-6 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"></path></svg>
                        Wyloguj
                    </button>
                </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main
      class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 md:py-10 w-full"
    >
    <div
      id="content"
      hx-get="/htmx/products?limit=8&amp;sort_by=name&amp;order=asc"
      hx-trigger="load"
      hx-swap="innerHTML"
    >

    <div class="flex justify-center items-center min-h-[60vh]">
          <svg
            class="animate-spin h-12 w-12 text-pink-600"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          </div>
    
    
      </div>
    </main>

    <footer class="bg-gray-100 border-t border-gray-200 py-8 text-gray-700">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div
          class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8 text-sm mb-8"
        >
          <div>
            <h3
              class="font-semibold text-gray-800 mb-3 uppercase tracking-wider"
            >
              Obsługa Klienta
            </h3>
            <ul class="space-y-2">
              <li>
                <a
                  href="/kontakt"
                  hx-get="/htmx/page/kontakt"
                  hx-target="#content"
                  hx-push-url="/kontakt"
                  class="hover:underline hover:text-pink-600 transition-colors"
                  >Kontakt</a
                >
              </li>
              <li>
                <a
                  href="/wysylka-i-zwroty"
                  hx-get="/htmx/page/wysylka-i-zwroty"
                  hx-target="#content"
                  hx-push-url="/wysylka-i-zwroty"
                  class="hover:underline hover:text-pink-600 transition-colors"
                  >Wysyłka i zwroty</a
                >
              </li>
              <li>
                <a
                  href="/faq"
                  hx-get="/htmx/page/faq"
                  hx-target="#content"
                  hx-push-url="/faq"
                  class="hover:underline hover:text-pink-600 transition-colors"
                  >FAQ</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h3
              class="font-semibold text-gray-800 mb-3 uppercase tracking-wider"
            >
              Informacje
            </h3>
            <ul class="space-y-2">
              <li>
                <a
                  href="/o-nas"
                  hx-get="/htmx/page/o-nas"
                  hx-target="#content"
                  hx-push-url="/o-nas"
                  class="hover:underline hover:text-pink-600 transition-colors"
                  >O nas</a
                >
              </li>
              <li>
                <a
                  href="/polityka-prywatnosci"
                  hx-get="/htmx/page/polityka-prywatnosci"
                  hx-target="#content"
                  hx-push-url="/polityka-prywatnosci"
                  class="hover:underline hover:text-pink-600 transition-colors"
                  >Polityka prywatności</a
                >
              </li>
              <li>
                <a
                  href="/regulamin"
                  hx-get="/htmx/page/regulamin"
                  hx-target="#content"
                  hx-push-url="/regulamin"
                  class="hover:underline hover:text-pink-600 transition-colors"
                  >Regulamin sklepu</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h3
              class="font-semibold text-gray-800 mb-3 uppercase tracking-wider"
            >
              Kategorie
            </h3>
            <ul class="space-y-2">
              <li>
                <a
                  href="/dla-niej"
                  hx-get="/dla-niej"
                  hx-target="#content"
                  hx-push-url="/dla-niej"
                  class="hover:underline hover:text-pink-600 transition-colors"
                  >Dla niej</a
                >
              </li>
              <li>
                <a
                  href="/dla-niego"
                  hx-get="/dla-niego"
                  hx-target="#content"
                  hx-push-url="/dla-niego"
                  class="hover:underline hover:text-pink-600 transition-colors"
                  >Dla niego</a
                >
              </li>
              <li>
                <a
                  href="/nowosci"
                  hx-get="/htmx/products?sort_by=created_at&amp;order=desc"
                  hx-target="#content"
                  hx-push-url="/nowosci"
                  class="hover:underline hover:text-pink-600 transition-colors"
                  >Nowości</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h3
              class="font-semibold text-gray-800 mb-3 uppercase tracking-wider"
            >
              Śledź nas
            </h3>
            <div class="flex space-x-4">
              <a
                href="https://facebook.com/megjoni"
                target="_blank"
                rel="noopener noreferrer"
                class="text-gray-500 hover:text-blue-600 transition-colors"
                aria-label="Facebook"
                ><span class="sr-only">Facebook</span
                ><svg
                  class="w-6 h-6"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    d="M12 2.04C6.48 2.04 2 6.52 2 12.06c0 4.99 3.66 9.13 8.44 9.88v-6.99H7.9v-2.89h2.54V9.81c0-2.51 1.49-3.89 3.78-3.89 1.09 0 2.24.2 2.24.2v2.46h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.77l-.44 2.89h-2.33v6.99A10.01 10.01 0 0022 12.06C22 6.52 17.52 2.04 12 2.04z"
                  /></svg
              ></a>
              <a
                href="https://instagram.com/meg.joni"
                target="_blank"
                rel="noopener noreferrer"
                class="text-gray-500 hover:text-pink-500 transition-colors"
                aria-label="Instagram"
                ><span class="sr-only">Instagram</span
                ><svg
                  class="w-6 h-6"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    d="M12 2c2.72 0 3.05.01 4.12.06 1.06.05 1.79.22 2.42.46.65.25 1.23.59 1.77 1.15.54.55.89 1.12 1.14 1.77.24.63.41 1.36.46 2.42.05 1.07.06 1.4.06 4.12s-.01 3.05-.06 4.12c-.05 1.06-.22 1.79-.46 2.42-.25.65-.59 1.23-1.14 1.77-.54-.55-1.12.89-1.77 1.14-.63.24-1.36.41-2.42.46-1.07.05-1.4.06-4.12.06s-3.05-.01-4.12-.06c-1.06-.05-1.79-.22-2.42-.46-.65-.25-1.23-.59-1.77-1.14-.54-.55-.89-1.12-1.14-1.77-.24-.63-.41-1.36-.46-2.42-.05-1.07-.06-1.4-.06-4.12s.01-3.05.06-4.12c.05-1.06.22-1.79.46 2.42.25-.65.59-1.23 1.14 1.77.54-.55 1.12.89 1.77-1.14.63-.24 1.36.41 2.42-.46C8.95 2.01 9.28 2 12 2zm0 1.8c-2.67 0-3 .01-4.05.06-1.02.04-1.63.21-2.13.41-.56.2-.98.5-1.41.93-.42.43-.72.85-.92 1.41-.2.5-.37 1.11-.41 2.13-.05 1.05-.06 1.38-.06 4.05s.01 3 .06 4.05c.04 1.02.21 1.63.41 2.13.2.56.5.98.92 1.41.43.42.85.72 1.41.92.5.2 1.11.37 2.13.41 1.05.05 1.38.06 4.05.06h.01c2.67 0 3-.01 4.05-.06 1.02-.04 1.63.21 2.13-.41.56-.2.98-.5 1.41-.92.42-.43.72-.85.92-1.41.2-.5.37-1.11-.41-2.13.05-1.05.06-1.38.06-4.05s-.01-3-.06-4.05c-.04-1.02-.21-1.63-.41-2.13-.2-.56-.5-.98-.92-1.41-.43-.42-.85-.72-1.41-.92-.5-.2-1.11-.37-2.13-.41C15 3.81 14.67 3.8 12 3.8zm0 3.91c-2.27 0-4.1 1.83-4.1 4.1s1.83 4.1 4.1 4.1 4.1-1.83 4.1-4.1-1.83-4.1-4.1-4.1zm0 6.81c-1.5 0-2.71-1.21-2.71-2.71s1.21-2.71 2.71-2.71 2.71 1.21 2.71 2.71-1.21 2.71-2.71 2.71zm5.24-6.52c0 .6-.48 1.08-1.08 1.08s-1.08-.48-1.08-1.08.48-1.08 1.08-1.08 1.08.48 1.08 1.08z"
                  /></svg
              ></a>
            </div>
          </div>
        </div>
        <p class="text-center text-xs text-gray-500 mt-8">
          &copy; <span x-text="new Date().getFullYear()"></span>

          <template x-if="!isAuthenticated">
            <span>mess - all that vintage.</span>
          </template>

          <template x-if="isAuthenticated">
            <a href="/admin"
               hx-get="/htmx/admin"
               hx-target="#content"
               hx-swap="innerHTML"
               hx-push-url="/admin"
               class="font-medium hover:text-pink-600 transition-colors"
               title="Przejdź do Panelu Admina"
            >mess - all that vintage.</a>
          </template>
  
          Wszelkie prawa zastrzeżone.
        </p>
      </div>
    </footer>

    <aside
      x-show="cartOpen"
      class="fixed inset-0 z-50 flex justify-end"
      x-cloak
    >
      <div
        @click="cartOpen = false"
        x-show="cartOpen"
        class="fixed inset-0 transition-opacity"
        style="background-color: rgba(0, 0, 0, 0.85) !important"
        x-transition:enter="transition-opacity ease-in-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition-opacity ease-in-out duration-300"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
      ></div>
      <div
        x-show="cartOpen"
        @click.away="cartOpen = false"
        x-transition:enter="transform transition ease-in-out duration-300 sm:duration-300"
        x-transition:enter-start="translate-x-full"
        x-transition:enter-end="translate-x-0"
        x-transition:leave="transform transition ease-in-out duration-300 sm:duration-300"
        x-transition:leave-start="translate-x-0"
        x-transition:leave-end="translate-x-full"
        class="relative flex flex-col max-w-md w-full bg-white shadow-xl pt-4 pb-6 overflow-y-auto"
      >
        <div
          class="px-4 sm:px-6 flex items-center justify-between pb-4 border-b"
        >
          <h2 class="text-lg font-medium text-gray-900">Twój koszyk</h2>
          <button
            @click="cartOpen = false"
            type="button"
            class="-mr-2 p-2 inline-flex items-center justify-center rounded-md text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-pink-500"
            aria-label="Zamknij koszyk"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
        <div class="mt-2 px-0 sm:px-0 relative flex-1 flex flex-col">
          <div
            id="cart-content-target"
            class="flex-grow"
            hx-get="/htmx/cart/details"
            hx-trigger="load, updateCartDisplay from:body, cartOpened from:body"
            hx-swap="innerHTML"
          >
            <div class="flex justify-center items-center h-full py-10">
              <svg
                class="animate-spin h-8 w-8 text-pink-600"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
            </div>
          </div>
        </div>
        <div
          class="border-t border-gray-200 px-4 sm:px-6 py-6 mt-auto"
          x-show="cartItemCount > 0"
          x-cloak
        >
          <div class="flex justify-between text-base font-medium text-gray-900">
            <p>Suma</p>
            <p id="cart-subtotal-price">0,00 zł</p>
          </div>
          <p class="mt-0.5 text-sm text-gray-500">
            Wysyłka i podatki obliczane przy kasie.
          </p>
          <div class="mt-6">
            <a
              href="/checkout"
              hx-get="/htmx/checkout"
              hx-target="#content"
              hx-swap="innerHTML"
              hx-push-url="/checkout"
              id="checkout-link"
              @click="cartOpen = false"
              class="flex items-center justify-center rounded-md border border-transparent bg-green-600 px-6 py-3 text-base font-medium text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors"
            >
              Przejdź do kasy</a
            >
            </div>
          <div
            class="mt-6 flex justify-center text-center text-sm text-gray-500"
          >
            <p>
              lub
              <button
                type="button"
                @click="cartOpen = false"
                class="font-medium text-pink-600 hover:text-pink-500"
              >
                Kontynuuj zakupy<span aria-hidden="true"> &rarr;</span>
              </button>
            </p>
          </div>
        </div>
        <div
          class="px-4 sm:px-6 py-6 text-center mt-auto"
          x-show="cartItemCount === 0"
          x-cloak
        >
          <p class="text-gray-500">Twój koszyk jest pusty.</p>
        </div>
      </div>
    </aside>

<div
    x-show="activeImageModal.isOpen"
    x-cloak
    x-transition:enter="transition-opacity ease-in-out duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition-opacity ease-in-out duration-200"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/85 backdrop-blur-sm"
    @click="closeImageModal()"
    @touchstart.passive="handleTouchStart($event)"
    @touchmove.passive="handleTouchMove($event)"
    @touchend="handleTouchEnd()"      
    role="dialog"
    aria-modal="true"
    aria-labelledby="fullscreen-image-alt">

    <button @click.stop="closeImageModal()" type="button" class="absolute top-4 right-4 z-[70] p-2 bg-white/20 hover:bg-white/40 rounded-full text-white focus:outline-none transition-all" aria-label="Zamknij podgląd obrazka">
        <svg class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
    </button>
    <button x-show="activeImageModal.images.length > 1" @click.stop="prevImageModal()" type="button" class="absolute left-4 top-1/2 -translate-y-1/2 z-[70] p-3 bg-white/20 hover:bg-white/40 rounded-full text-white focus:outline-none focus:ring-2 focus:ring-white transition-all" aria-label="Poprzednie zdjęcie">
        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
    </button>
    <button x-show="activeImageModal.images.length > 1" @click.stop="nextImageModal()" type="button" class="absolute right-4 top-1/2 -translate-y-1/2 z-[70] p-3 bg-white/20 hover:bg-white/40 rounded-full text-white focus:outline-none focus:ring-2 focus:ring-white transition-all" aria-label="Następne zdjęcie">
        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
    </button>
        
      <div
              @click.stop
              class="relative rounded-lg shadow-2xl overflow-hidden"
              x-data="{ isZooming: false, zoomLevel: 2, originX: '50%', originY: '50%' }"
              x-init="$watch('activeImageModal.currentSrc', () => { isZooming = false })"
              @reset-image-zoom.window="isZooming = false"
              @click="if (window.innerWidth >= 768) isZooming = !isZooming"
              x-bind:class="{ 'md:cursor-zoom-in': !isZooming, 'md:cursor-zoom-out': isZooming }"
              @mousemove.throttle.16ms="
              if (isZooming) {
                  const rect = $el.getBoundingClientRect();
                  const x = (($event.clientX - rect.left) / rect.width) * 100;
                  const y = (($event.clientY - rect.top) / rect.height) * 100;
                  originX = `${x}%`;
                  originY = `${y}%`;
              }
          "
      >
        <img

            :src="activeImageModal.currentSrc"
            id="fullscreen-image-alt"
            alt="Powiększone zdjęcie produktu"
            class="block object-contain w-auto h-auto max-w-[90vw] max-h-[90vh] rounded-lg transition-transform duration-300 ease-out"
            :style="{
                transform: isZooming ? `scale(${zoomLevel})` : 'scale(1)',
                transformOrigin: `${originX} ${originY}`
            }"
        />
    </div>
</div>    
    
    
    <div
      x-show="toast.show"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0 transform translate-y-2"
      x-transition:enter-end="opacity-100 transform translate-y-0"
      x-transition:leave="transition ease-in duration-300"
      x-transition:leave-start="opacity-100 transform translate-y-0"
      x-transition:leave-end="opacity-0 transform translate-y-2"
      class="fixed bottom-5 right-5 text-white px-4 py-3 rounded-md shadow-lg z-[100] text-sm"
      :class="{
        'bg-green-600': toast.type === 'success',
        'bg-red-600': toast.type === 'error',
        'bg-sky-600': toast.type === 'info',
        'bg-yellow-500 text-black': toast.type === 'warning'
      }"
      role="alert"
      x-cloak
    >
      <p x-text="toast.message"></p>
    </div>
    <div id="body-scripts-placeholder"></div>
  </body>
</html>
